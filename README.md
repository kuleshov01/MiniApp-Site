# Единая карта сахалинца - Мини-приложение

Мини-приложение для мессенджера Макс, позволяющее пользователям взаимодействовать с сервисами Единой карты сахалинца.

## Функции

1. **Получить карту** - Подача заявки на оформление Единой карты сахалинца
2. **Обратная связь** - Обращение в службу поддержки

## Установка и запуск

### Локальный запуск

```bash
# Запуск простого HTTP-сервера (Python)
python3 -m http.server 3000

# Или с использованием Node.js
cd miniapp
npm install
npm start
```

Приложение будет доступно по адресу http://localhost:3000 (или http://localhost:8080 для Node.js)

### Размещение на сервере

Загрузите содержимое директории `miniapp` на ваш сервер. 

Убедитесь, что сервер настроен на обслуживание статических файлов.

## Настройка

### URL почтового шлюза

Приложение использует следующие эндпоинты для отправки данных:

- **Заявка на карту**: `https://eks.sakhalin.gov.ru/sendmail-bank-applying/`
- **Обратная связь**: `https://eks.sakhalin.gov.ru/api/gateway`

Для изменения URL-адресов отредактируйте файл `script.js`:

```javascript
// Для заявки на карту (строка 253)
const response = await fetch('https://your-server.com/sendmail-bank-applying/', {

// Для обратной связи (строка 96)
const gatewayUrl = 'https://your-server.com/api/gateway';
```

### Формат данных для почтового шлюза

Приложение отправляет POST-запросы с данными:

#### Заявка на карту

**Эндпоинт**: `POST https://eks.sakhalin.gov.ru/sendmail-bank-applying/`

**Content-Type**: `application/x-www-form-urlencoded; charset=UTF-8`

**Режим**: `no-cors`

**Поля формы**:
- `bank` - название банка (например, "Газпромбанк")
- `bank-id` - идентификатор банка (gazp, atb, iturup, vtb)
- `forwhom` - на кого оформляется ("На себя" или "На ребенка")
- `forwhom-id` - идентификатор (self или child)
- `lastname` - фамилия
- `name` - имя
- `patron` - отчество (опционально)
- `mobPhone` - мобильный телефон
- `rstkAgree` - согласие на использование на транспорте (on/отсутствует)
- `dolgoletieAgree` - согласие на использование в "Сахалинском долголетии" (on/отсутствует)
- `aquaAgree` - согласие на использование в Аква Парке (on/отсутствует)
- `persAgree` - согласие на обработку персональных данных (on/отсутствует)
- `n` - timestamp заявки

#### Обратная связь

**Эндпоинт**: `POST https://eks.sakhalin.gov.ru/api/gateway`

**Content-Type**: `application/json`

**JSON-данные**:
```json
{
  "type": "support",
  "name": "Иван Иванов",
  "phone": "+7 (999) 123-45-67",
  "email": "ivan@mail.ru",
  "subject": "status",
  "message": "Узнать статус карты",
  "consent": true
}
```

**Возможные значения subject**:
- `status` - Узнать статус карты
- `activation` - Активация карты
- `loss` - Утеря карты
- `technical` - Технический вопрос
- `other` - Другое

## Интеграция с мессенджером Макс

Для интеграции добавьте мини-приложение в Макс:

1. Откройте настройки мини-приложений в Макс
2. Добавьте новый мини-апп
3. Укажите URL вашего приложения
4. Настройте параметры отображения

## Технологии

- HTML5
- CSS3 (мобильная адаптация)
- Vanilla JavaScript
- Fetch API для отправки данных на сервер

## Поддержка экранов

Приложение оптимизировано для мобильных устройств с разрешением от 320px до 480px по ширине.

## История изменений

### 07.02.2026
- Удалён блок с номером контактного центра в модуле обратной связи
- Добавлена сноска о согласии на обработку персональных данных в форме обратной связи (в соответствии с ФЗ от 27.07.2006 No 152-ФЗ)